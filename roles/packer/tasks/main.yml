---
- name: load samba dependencies package list
  include_vars: "{{package_list_file}}"

- name: create temp file for packer template
  tempfile:
    state: file
    prefix: "ansible-packer-"
    suffix: ".json"
  register: tempfile_task

- name: render packer config file
  template:
    src: templates/template.json
    dest: "{{tempfile_task.path}}"
    validate: packer validate %s
  vars:
    apt_install_packages: "{{packages|join(' ')}}"

- name: packer build
  command: packer build "{{tempfile_task.path}}"
